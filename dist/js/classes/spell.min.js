class Spell{constructor(t){this.timer=0,this.cost=0,this.cooldown=0,this.player=t,this.refund=!0,this.canDodge=!0,this.totaldmg=0,this.data=[0,0,0,0,0],this.name=this.constructor.name,this.useonly=!1,this.maxdelay=100,this.weaponspell=!0}dmg(){return 0}use(){this.player.timer=1500,this.player.rage-=this.cost,this.timer=1e3*this.cooldown}step(t){return this.timer<=t?(this.timer=0,log&&this.player.log(`${this.name} off cooldown`)):this.timer-=t,this.timer}canUse(){return 0==this.timer&&this.cost<=this.player.rage}}class Mangle extends Spell{constructor(t){super(t),this.cost=20-t.talents.ferocity,this.cooldown=6,this.refund=!1,this.threshold=parseInt(spells[0].minrage),this.maxdelay=parseInt(spells[0].reaction),this.weaponspell=!1}dmg(){let t;return 1.15*((t=this.player.weaponrng?rng(this.player.mh.mindmg+this.player.mh.bonusdmg,this.player.mh.maxdmg+this.player.mh.bonusdmg):avg(this.player.mh.mindmg+this.player.mh.bonusdmg,this.player.mh.maxdmg+this.player.mh.bonusdmg))+this.player.stats.ap/14*2.5)+155}canUse(){return!this.timer&&!this.player.timer&&this.cost<=this.player.rage&&this.player.rage>=this.threshold}}class Swipe extends Spell{constructor(t){super(t),this.cost=20-t.talents.ferocity,this.cooldown=0,this.refund=!1,this.threshold=parseInt(spells[1].minrage),this.maxdelay=parseInt(spells[1].reaction)}dmg(){return.07*this.player.stats.ap+84}canUse(){return!this.timer&&!this.player.timer&&this.cost<=this.player.rage&&(this.player.rage>=this.threshold||this.player.spells.mangle&&this.player.spells.mangle.timer>=this.maincd)}}class Lacerate extends Spell{constructor(t){super(t),this.cost=15-t.talents.shreddingattacks,this.cooldown=0,this.threshold=parseInt(spells[2].minrage),this.maincd=1e3*parseInt(spells[2].maincd),this.maxdelay=parseInt(spells[2].reaction)}dmg(){let t;return t=this.player.weaponrng?35+rng(this.player.mh.mindmg+this.player.mh.bonusdmg,this.player.mh.maxdmg+this.player.mh.bonusdmg):35+avg(this.player.mh.mindmg+this.player.mh.bonusdmg,this.player.mh.maxdmg+this.player.mh.bonusdmg),31}use(){this.player.timer=1500,this.player.rage=Math.min(this.player.rage,this.player.talents.rageretained),this.player.rage-=this.cost,this.timer=1e3*this.cooldown}canUse(){return!this.timer&&!this.player.timer&&this.cost<=this.player.rage&&this.player.dodgetimer&&this.player.rage<=this.threshold&&this.player.spells.mangle&&this.player.spells.mangle.timer>=this.maincd}}class Maul extends Spell{constructor(t){super(t),this.cost=15-t.talents.ferocity,this.threshold=parseInt(spells[2].minrage),this.maincd=1e3*parseInt(spells[2].maincd),this.name="Maul",this.bonus=226,this.maxdelay=parseInt(spells[2].reaction),this.useonly=!0}use(){this.player.nextswinghs=!0}canUse(){return!this.player.nextswinghs&&this.cost<=this.player.rage&&(this.player.rage>=this.threshold||this.player.spells.mangle&&this.player.spells.mangle.timer>=this.maincd)}}class FaerieFire extends Spell{constructor(t){super(t),this.cost=0,this.globals=parseInt(spells[4].globals),this.maxdelay=parseInt(spells[4].reaction),this.stacks=0,this.nocrit=!0,this.name="Faerie Fire"}use(){this.player.timer=4e3,this.player.rage-=this.cost,this.stacks++}canUse(){return!this.player.timer&&this.stacks<this.globals&&this.cost<=this.player.rage}}class Aura{constructor(t){this.timer=0,this.starttimer=0,this.stats={},this.mult_stats={},this.player=t,this.firstuse=!0,this.duration=0,this.stacks=0,this.uptime=0,this.name=this.constructor.name,this.maxdelay=100,this.useonly=!0}use(){this.timer&&(this.uptime+=step-this.starttimer),this.timer=step+1e3*this.duration,this.starttimer=step,this.player.updateAuras()}step(){step>=this.timer&&(this.uptime+=this.timer-this.starttimer,this.timer=0,this.firstuse=!1,this.player.updateAuras())}end(){this.uptime+=step-this.starttimer,this.timer=0,this.stacks=0}}class LacerateDOT extends Aura{constructor(t){super(t),this.duration=12,this.name="Lacerate DOT",this.idmg=0,this.totaldmg=0,this.lasttick=0}step(){for(;step>=this.nexttick;){let t=31+this.player.ap/100;console.log("%d %s: %d",step,this.name,~~(t/4)),this.idmg+=~~(t/4),this.totaldmg+=~~(t/4),this.nexttick+=3e3}step>=this.timer&&(this.uptime+=this.timer-this.starttimer,this.timer=0,this.firstuse=!1)}use(){this.timer&&(this.uptime+=step-this.starttimer),this.nexttick=step+3e3,this.timer=step+1e3*this.duration,this.starttimer=step,log&&this.player.log(`${this.name} applied`)}}class Pummeler extends Aura{constructor(t){super(t),this.duration=30,this.mult_stats={haste:50},this.name="Manual Crowd Pummeler"}use(){this.player.timer=1500,this.timer&&(this.uptime+=step-this.starttimer),this.timer=step+1e3*this.duration,this.starttimer=step,this.player.updateHaste()}step(){step>=this.timer&&(this.uptime+=this.timer-this.starttimer,this.timer=0,this.firstuse=!1,this.player.updateHaste())}canUse(){return this.firstuse&&!this.timer&&!this.player.timer&&!this.player.itemtimer}}class Swarmguard extends Aura{constructor(t){super(t),this.duration=30,this.armor=200,this.stacks=0,this.chance=5e3,this.timetoend=3e4}use(){this.timer=step+1e3*this.duration,this.starttimer=step,this.stacks=0}canUse(){return this.firstuse&&!this.timer&&step>=this.usestep}proc(){this.stacks=Math.min(this.stacks+1,6),this.player.updateArmorReduction()}step(){step>=this.timer&&(this.uptime+=this.timer-this.starttimer,this.timer=0,this.stacks=0,this.firstuse=!1,this.player.updateArmorReduction())}}class Slayer extends Aura{constructor(t){super(t),this.duration=20,this.stats={ap:260},this.name="Slayer's Crest"}use(){this.player.timer=1500,this.player.itemtimer=1e3*this.duration,this.timer=step+1e3*this.duration,this.starttimer=step,this.player.updateAP()}canUse(){return this.firstuse&&!this.timer&&!this.player.timer&&!this.player.itemtimer}}class Spider extends Aura{constructor(t){super(t),this.duration=15,this.mult_stats={haste:20},this.name="Kiss of the Spider"}use(){this.player.timer=1500,this.player.itemtimer=1e3*this.duration,this.timer=step+1e3*this.duration,this.starttimer=step,this.player.updateHaste()}canUse(){return this.firstuse&&!this.timer&&!this.player.timer&&!this.player.itemtimer}}class BloodlustBrooch extends Aura{constructor(t){super(t),this.duration=20,this.stats={ap:278}}use(){this.player.timer=2e3,this.player.itemtimer=1e3*this.duration,this.timer=step+1e3*this.duration,this.starttimer=step,this.player.updateAP()}canUse(){return this.firstuse&&!this.timer&&!this.player.timer&&!this.player.itemtimer}}