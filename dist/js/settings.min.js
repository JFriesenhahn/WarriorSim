var SIM=SIM||{};SIM.SETTINGS={init:function(){this.variables(),this.events(),this.buildSpells(),this.buildBuffs(),this.buildTalents()},variables:function(){this.body=$("body"),this.buffs=this.body.find("article.buffs"),this.fight=this.body.find("article.fight"),this.rotation=this.body.find("article.rotation"),this.talents=this.body.find("article.talents"),this.filter=this.body.find("article.filter"),this.close=this.body.find("section.settings .btn-close"),this.bg=this.body.find("section.sidebar .bg")},events:function(){var t=this;t.close.click(function(t){t.preventDefault(),$(".js-settings").removeClass("active"),$("section.settings").removeClass("active")}),t.buffs.on("click",".icon",function(){let e=$(this).toggleClass("active");e.hasClass("active")&&(e.data("group")&&e.siblings().filter('[data-group="'+e.data("group")+'"]').removeClass("active"),e.data("disable-spell")&&$('.rotation [data-id="'+e.data("disable-spell")+'"]').removeClass("active"));for(let e of buffs)e.active=t.buffs.find('[data-id="'+e.id+'"]').hasClass("active");SIM.UI.updateSession(),SIM.UI.updateSidebar()}),t.talents.on("click",".icon",function(e){let a=t.getTalent($(this));a.c=a.c<a.m?a.c+1:a.m,$(this).attr("data-count",a.c),a.c>=a.m&&$(this).addClass("maxed"),a.enable&&$('.rotation [data-id="'+a.enable+'"]').removeClass("hidden"),$(this).find("a").attr("href","https://tbc.wowhead.com/spell="+a.s[0==a.c?0:a.c-1]),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),t.talents.on("contextmenu",".icon",function(e){e.preventDefault();let a=t.getTalent($(this));if(a.c=a.c<1?0:a.c-1,$(this).attr("data-count",a.c),$(this).removeClass("maxed"),0==a.c&&a.enable){$('.rotation [data-id="'+a.enable+'"]').removeClass("active").addClass("hidden");for(let t of spells)t.id==a.enable&&(t.active=!1)}$(this).find("a").attr("href","https://tbc.wowhead.com/spell="+a.s[0==a.c?0:a.c-1]),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),t.filter.on("click",".sources li",function(e){if($(this).toggleClass("active"),$(this).hasClass("active")){let e=$(this).data("id");t.filter.find(`.phases [data-sources*="${e}"]`).addClass("active")}SIM.UI.updateSession(),SIM.UI.filterGear()}),t.filter.on("click",".phases li",function(e){$(this).toggleClass("active");let a=$(this).data("sources").split(","),i=$(this).hasClass("active");for(let e of a)i?t.filter.find('.sources [data-id="'+e+'"]').addClass("active"):t.filter.find('.sources [data-id="'+e+'"]').removeClass("active");SIM.UI.updateSession(),SIM.UI.filterGear()}),t.rotation.on("click",".spell",function(t){let e=t.target;if("LI"==e.nodeName||"INPUT"==e.nodeName)return;$(this).toggleClass("active");let a=$(this).data("id");for(let t of spells)t.id==a&&(t.active=$(this).hasClass("active"));SIM.UI.updateSession()}),t.rotation.on("keyup",'input[type="text"]',function(t){let e=$(this).parents(".spell").data("id");for(let t of spells)t.id==e&&(t[$(this).attr("name")]=$(this).val());SIM.UI.updateSession()}),t.fight.on("change",'select[name="race"]',function(e){var a=$(this).val(),i=t.rotation.find('[data-id="20572"]'),s=t.rotation.find('[data-id="26296"]'),n=[];"Orc"==a?i.removeClass("hidden"):(i.addClass("hidden").removeClass("active"),n.push(20572)),"Troll"==a?s.removeClass("hidden"):(s.addClass("hidden").removeClass("active"),n.push(26296));for(let t of spells)n.includes(t.id)&&(t.active=!1);t.bg.attr("data-race",a),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),t.fight.on("keyup",'input[type="text"]',function(t){SIM.UI.updateSession(),SIM.UI.updateSidebar()}),t.fight.on("change",'select[name="weaponrng"]',function(t){SIM.UI.updateSession(),SIM.UI.updateSidebar()}),t.fight.on("change",'select[name="batching"]',function(t){SIM.UI.updateSession(),SIM.UI.updateSidebar()})},buildSpells:function(){for(let t of spells){let e=115671==t.id?11567:t.id,a=$(`<div data-id="${t.id}" class="spell"><div class="icon">\n            <img src="dist/img/${t.iconname.toLowerCase()}.jpg " alt="${t.name}">\n            <a href="https://tbc.wowhead.com/spell=${e}" class="wh-tooltip"></a>\n            </div><ul class="options"></ul></div>`);void 0!==t.globals&&a.find(".options").append(`<li>Use on first <input type="text" name="globals" value="${t.globals}" data-numberonly="true" /> globals</li>`),void 0!==t.maincd&&a.find(".options").append(`<li>Mangle cooldown >= <input type="text" name="maincd" value="${t.maincd}" data-numberonly="true" /> secs</li>`),void 0!==t.crusaders&&a.find(".options").append(`<li>when <input type="text" name="crusaders" value="${t.crusaders}" data-numberonly="true" /> crusaders are up</li>`),void 0!==t.haste&&a.find(".options").append(`<li>Attack speed at <input type="text" name="haste" value="${t.haste}" data-numberonly="true" /> %</li>`),void 0!==t.priorityap&&a.find(".options").append(`<li>Prioritize Swipe when >= <input style="width:25px" type="text" name="priorityap" value="${t.priorityap}" data-numberonly="true" /> AP</li>`),void 0!==t.reaction&&a.find(".options").append(`<li><input style="width:25px" type="text" name="reaction" value="${t.reaction}" data-numberonly="true" /> ms reaction time</li>`),t.hidden&&a.addClass("hidden"),t.active&&a.addClass("active"),void 0!==t.maincd&&a.find(".options li:first-of-type").append(" or"),void 0!==t.crusaders&&a.find(".options li:first-of-type").append(" or"),26996==t.id&&(a.find(".options").empty(),a.find(".options").append('<li>Queue when above <input type="text" name="minrage" value="30" data-numberonly="true"> rage or BT/MS cooldown >= <input type="text" name="maincd" value="4" data-numberonly="true"> secs</li>'),a.find(".options").append(`<li><input style="width:25px" type="text" name="reaction" value="${t.reaction}" data-numberonly="true" /> ms reaction time</li>`)),this.rotation.append(a)}this.rotation.children().eq(3).appendTo(this.rotation),this.rotation.children().eq(19).appendTo(this.rotation)},buildBuffs:function(){for(let t of buffs){let e=t.spellid?"spell":"item",a=t.active?"active":"",i=t.group?`data-group="${t.group}"`:"",s=t.disableSpell?`data-disable-spell="${t.disableSpell}"`:"",n=`<div data-id="${t.id}" class="icon ${a}" ${i} ${s}>\n                            <img src="dist/img/${t.iconname.toLowerCase()}.jpg " alt="${t.name}">\n                            <a href="https://tbc.wowhead.com/${e}=${t.id}" class="wh-tooltip"></a>\n                        </div>`;this.buffs.append(n)}},buildTalents:function(){for(let t of talents){let e=$('<table><tr><th colspan="4">'+t.n+"</th></tr></table>");for(let t=0;t<7;t++)e.prepend("<tr><td></td><td></td><td></td><td></td></tr>");for(let a of t.t){let t=$('<div class="icon" data-count="'+a.c+'" data-x="'+a.x+'" data-y="'+a.y+'"></div>');t.html('<img src="dist/img/'+a.iconname.toLowerCase()+'.jpg" alt="'+a.n+'" />'),a.c>=a.m&&t.addClass("maxed"),a.enable&&0==a.c&&this.rotation.find('[data-id="'+a.enable+'"]').addClass("hidden"),a.enable&&a.c>0&&this.rotation.find('[data-id="'+a.enable+'"]').removeClass("hidden"),t.append('<a href="https://tbc.wowhead.com/spell='+a.s[0==a.c?0:a.c-1]+'" class="wh-tooltip"></a>'),e.find("tr").eq(a.y).children().eq(a.x).append(t)}this.talents.append(e)}},getTalent:function(t){let e=t.parents("table").index(),a=t.data("x"),i=t.data("y");for(let t of talents[e-1].t)if(t.x==a&&t.y==i)return t}};